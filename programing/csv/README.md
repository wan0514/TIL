# CSV 미션

## 1. 사전 학습할 것

- CSV 파일이 무엇인가
- 어떻게 생성하는가
- 어떻게 읽는가
- 어떻게 삭제하는가

---

## 2. CSV 파일

CSV(Comma-Separated Values) 파일은 데이터를 쉼표(`,`)로 구분하여 저장하는 텍스트 파일 형식이다.

### CSV 파일의 특징

- 텍스트 기반 → 사람이 읽을 수 있고, 가볍다.
- 각 행이 한 개의 레코드(데이터 행) → 표 형태의 데이터를 저장하기 적합하다.
- 각 열(컬럼)은 쉼표(`,`)로 구분 → 데이터베이스, 스프레드시트(엑셀) 등에서 쉽게 사용 가능하다.

---

## 3. CSV 파일 생성

CSV 파일을 저장하는 방법은 사용 환경(브라우저, Node.js, 엑셀 등)에 따라 다르다.

- **브라우저 환경**

  - CSV 데이터를 문자열로 만들고, `Blob` 객체를 사용해서 파일을 다운로드.

- **Node.js 환경**
  - `fs` (파일 시스템) 모듈을 사용하여 CSV 파일을 저장.

### fs(File System) 모듈이란?

Node.js가 제공하는 API로, 파일 시스템을 제어하는 모듈.

#### Node.js `fs` 모듈의 특징

- 운영체제의 파일 시스템을 제어할 수 있도록 API 제공.
- 비동기(`fs.writeFile()`)와 동기(`fs.writeFileSync()`) 방식 모두 지원.
- 파일 생성, 읽기, 수정, 삭제 가능.
- 운영체제(OS)와 상관없이 Node.js에서 동일한 코드로 실행 가능.

#### 파일 시스템 vs Node.js `fs` 모듈

- **파일 시스템**: 운영체제가 관리하는 파일 저장 방식.
- **Node.js의 `fs` 모듈**: 파일 시스템을 코드로 조작하는 도구.

---

## 4. CSV 파일 읽기

### 4.1 `fs.readFile()` 사용 (기본 방식)

- CSV 파일을 문자열로 읽어옴.
- `split("\n")`을 사용해 행 단위로 나누고, `split(",")`을 이용해 열 단위로 분리 가능.
- 단순한 CSV 파일 처리에 적합하지만, 데이터 변환이 필요함.

### 4.2 `fs.createReadStream()` + `csv-parser` 사용 (라이브러리)

- `csv-parser` 라이브러리를 사용하여 CSV 데이터를 JSON 객체로 변환.
- CSV의 첫 번째 행(헤더)을 자동으로 키로 인식하여 구조화된 데이터 제공.
- 대량의 CSV 데이터를 효율적으로 처리할 수 있음.

### 4.3 정리

| 방법                        | 특징                                      |
| --------------------------- | ----------------------------------------- |
| `fs.readFile()` + `split()` | 문자열로 읽고 배열로 변환 가능            |
| `csv-parser`                | JSON 형태로 변환, 대량 데이터 처리에 적합 |

---

## 5. CSV 파일 삭제

### 5.1 `fs.unlink()` 사용

- 특정 CSV 파일을 삭제하는 기본적인 방법.
- 파일이 존재하지 않으면 오류 발생 가능.

### 5.2 `fs.rm()` 사용 (최신 방식)

- `fs.unlink()`와 유사하지만, 디렉토리까지 삭제할 수도 있음 (`recursive: true` 옵션).
- 최신 Node.js 버전(>= v14.14)에서 사용 가능.

### 5.3 정리

| 방법                  | 특징                                                           |
| --------------------- | -------------------------------------------------------------- |
| `fs.unlink("파일명")` | 기본적인 파일 삭제                                             |
| `fs.rm("파일명")`     | 최신 방식, 디렉토리 삭제 가능 (`recursive: true` 옵션 사용 시) |

---

## 6. 결론

- 간단한 CSV 파일 처리는 `fs.readFile() + split()`을 사용.
- JSON 형태로 변환하려면 `csv-parser`를 사용하는 것이 가장 편리함.
- 파일 삭제는 `fs.unlink()`를 사용하며, 최신 방식으로 `fs.rm()`을 사용할 수도 있음.

---

# 구현

## 객체와 모듈의 차이는 무엇인가?

SQL 형식의 문장을 반복해서 처리하면서, 데이터를 CSV 파일로 저장하고, 데이터 형식을 따로 관리해야 한다면, **객체와 모듈을 나누는 기준**을 잘 정해야 유지보수하기 좋은 구조를 만들 수 있다.

### **💡 객체 vs. 모듈을 나누는 기준**

| 구분            | 객체 (Object)                                          | 모듈 (Module)                                |
| --------------- | ------------------------------------------------------ | -------------------------------------------- |
| **역할**        | 특정 데이터를 관리하거나 조작                          | 여러 기능을 묶어서 독립적인 코드 단위로 제공 |
| **상태(State)** | 상태를 가지며, 그 상태를 기반으로 동작                 | 보통 상태 없이 함수(유틸리티)를 제공         |
| **재사용성**    | 같은 데이터를 다루는 여러 개의 인스턴스를 만들 수 있음 | 여러 파일에서 import하여 사용                |

---

## **🔍 1. 데이터 관리와 CSV 파일 저장을 어떻게 나눌 것인가?**

- **CSV 파일을 생성하고 저장하는 기능은 모듈로 만들 것인가?**  
  → CSV 파일을 저장하는 기능은 상태를 가질 필요 없이 단순한 함수로 만들 수 있어.  
  → `csvHandler.js` 같은 모듈을 만들어서 `export function saveToCSV()` 같은 방식으로 관리하면 좋음.

- **데이터 자체를 객체로 만들어야 하는가?**  
  → 데이터에는 여러 개의 테이블이 있을 것이고, 각 테이블은 컬럼(데이터 형식)을 관리해야 함.  
  → 이걸 **객체로 만들어서 인스턴스를 관리하는 게 좋음.**  
  → 예를 들어, `Table` 클래스를 만들어서 테이블마다 컬럼과 데이터를 관리하게 할 수 있음.

---

# 기능 구현

## 어떻게 입력값을 분석해서 각각의 기능을 실행할 것인가?

정규식 표현을 이용하여 입력값을 분석하는 함수를 만든다.
분석한 값을 객체로 반환한다. 객체는 명령어마다 구조가 다르다.

```
{ command: 'CREATE', tableName, columns, dataTypes };
{ command: 'INSERT', tableName, columns, values };
{ command: 'DELETE', tableName, condition };
```

해당 객체의 공통 키는 command이며, 이를 통해 어떤 명령인지 switch 문으로
각각의 기능 함수를 실행시킨다.

```
  switch (parsedInput.command) {
    case 'CREATE':
      createFile(parsedInput);
      break;
    case 'INSERT':
      insertToFile(parsedInput);
      break;
    case 'DELETE':
      deleteFrom(parsedInput);
      break;
    default:
      console.log('Unknown command');
  }
```

## 어떻게 칼럼의 dataType과 id값을 저장하고 조회할 것인가?

csv파일을 다루는 모듈과 칼럼 정보를 관리하는 스키마매니저 객채를 따로 구현한다.
추가,삭제 등이 이루어지면 동기화를 시킨다.

1. CsvHanlder.js (CSV 파일을 다루는 모듈)

- CSV 파일 생성
- 데이터 읽기/쓰기
- 칼럼 추가/삭제

2. class Table , Database (테이블 데이터 관리 객체)

- 테이블 생성(Table객체를 만든 후 이를 기반으로 csv파일 생성)
- 칼럼 ID 관리
- 데이터 타입 관리
- 칼럼 추가/삭제

## 실수

### 1. 잘못 파싱된 입력값

원인 : 정규식표현의 캡처 구문을 제대로 작성하지 않아 match[index]로 접근했을 때 다른 값이 들어갔었습니다.

### 2. 테이블이 존재함에도 존재하지 않는 테이블 에러가 발생

원인 : 테이블 존재 여부 함수를 조건문에 넣었으나 !(not 연산자)를 사용하여 함수 반환값이 반대가 되어서, 존재함에도 에러가 발생했었습니다.

# 개선할 점

- 에러 핸들링: 사용자가 입력했을 때 어떤 에러인지 잡아내서 사용자에게 보여줘야 합니다. 현재는 정규표현식으로 포괄적인 에러를 던지는 식으로 구현이 되어있어 개발자와 사용자 모두에게 어떤 에러인지 세세하게 확인하기 어렵습니다.

- fs모듈로 Csv파일 다루기 : 현재 데이터베이스를 class로 만들어서 class의 매서드로 데이터를 업데이트하고, 이를 기반으로 csv파일을 overwirte하는 방식으로 구현했으나, fs모듈의 appendFIle 등의 매서드를 활용하면 database를 구축하지 않고 csv파일과 테이블정보만 담은 객체를 선언하여 구현할 수 있습니다.
