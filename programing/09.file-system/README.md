# 🛠 **FAT12 에뮬레이터 구현 **

## 목표

FAT12 작동원리와 파일 시스템의 동작 방식을 이해하고 구현해보자.

## 📌 **FAT12 구조 설계**

### ✅ **기본 설계 원칙**

1. **실제 FAT12처럼 동작하되, 불필요한 복잡성을 줄인다.**
2. **파일 개수를 최소화하여 myfs.dat 내에서 모든 데이터를 관리한다.**
3. **디렉토리 정보, 파일 정보, 데이터 영역을 분리하여 저장한다.**
4. **FAT 테이블을 단순화하여 클러스터 체인 관리만 담당한다.**
5. **처음에는 JSON 파일로 만들되, 추후 바이너리 파일로 리팩토링을 하자.**

## **📂 파일 구조 (간략화된 FAT12)**

```
📂 myfs_project
 ├── 📄 myfs.dat   // 실제 파일 데이터 저장
 ├── 📄 myfs.dir   // 디렉토리 구조 및 파일 메타데이터 저장
 ├── 📄 myfs.info  // 파일 시스템 전반적인 정보 저장
 ├── 📄 fs.js      // 파일 시스템 구현 코드

```

---

📌 **핵심 개념**

- `myfs.dat` → **파일 데이터 + 디렉토리 데이터까지 포함 (FAT 포함 가능)**
- `myfs.dir` → **디렉토리 구조 및 파일 메타데이터 저장**
- `myfs.info` → **파일 시스템의 전반적인 정보 관리 (디스크 크기, 사용량 등)**

---

## 📂 **각 파일에 저장할 데이터 형식 (JSON 기준)**

### **✅ `myfs.dat` (실제 데이터 저장, 크기 고정)**

이 파일에는 **파일 내용과 디렉토리 내용을 클러스터 단위로 저장**

```json
{
  "clusters": {
    "0": "root directory data...",
    "1": "Hello, world! This is file1.txt",
    "2": "Another file data...",
    "3": ""
  }
}
```

📌 **설명**

- 각 클러스터(블록) 단위로 저장됨.
- **파일 데이터뿐만 아니라, 디렉토리 정보도 저장됨!**
- 고정된 크기를 넘지 않도록 관리해야 함.

---

### **✅ `myfs.dir` (디렉토리 구조 및 파일 메타데이터)**

이 파일은 **디렉토리와 파일들의 정보를 저장**하는 역할

```json
{
  "root": {
    "type": "dir",
    "files": {
      "file1.txt": { "size": 27, "startCluster": 1 },
      "file2.bin": { "size": 20, "startCluster": 2 }
    },
    "subdirs": {
      "docs": {
        "type": "dir",
        "files": { "report.pdf": { "size": 50, "startCluster": 3 } },
        "subdirs": {}
      }
    }ㄴ
  }
}
```

📌 **설명**

- **파일 이름, 크기, 시작 클러스터** 정보 포함.
- **트리 구조**로 디렉토리를 표현 (폴더 안에 파일과 하위 폴더 포함).
- **클러스터를 참조**하여 실제 데이터를 `myfs.dat`에서 찾을 수 있음.

---

### **✅ `myfs.info` (파일 시스템 전체 정보)**

파일 시스템의 **크기, 사용된 공간, 남은 공간, FAT 테이블 정보 등**을 저장.

```json
{
  "totalSize": 1048576, // 1MB 가상 디스크
  "usedSpace": 512000, // 사용된 바이트 수
  "freeSpace": 536576, // 남은 바이트 수
  "clusterSize": 512, // 한 클러스터당 512B
  "totalClusters": 2048, // 총 2048개 클러스터
  "fat": {
    "1": -1, // file1.txt (1번 클러스터, EOF)
    "2": -1, // file2.bin (2번 클러스터, EOF)
    "3": -1 // report.pdf (3번 클러스터, EOF)
  }
}
```

📌 **설명**

- **파일 시스템 크기와 사용량 관리**
- **FAT 테이블을 포함하여 클러스터 연결 관리**
- FAT 값이 `-1`이면 EOF(파일 끝), 다른 값이면 다음 클러스터 번호

## 구현할 기능

1. **파일 시스템 초기화**

   - **입력:** 파일 시스템의 최대 크기
   - **기능:** 지정된 최대 크기를 가진 파일 시스템을 초기화, 루트 디렉토리 (`/`) 생성
   - **목표:** 여러 개의 폴더와 파일을 담을 수 있는 구조를 준비

2. **디렉토리 생성**

   - **입력:** 현재 디렉토리, 새로운 디렉토리 이름
   - **기능:** 지정된 디렉토리 내에 새로운 디렉토리 생성
   - **목표:** 디렉토리 안에 다른 디렉토리나 파일을 포함할 수 있도록 구현

3. **텍스트 파일 생성**

   - **입력:** 디렉토리명, 파일명, 파일 내용
   - **기능:** 텍스트 파일 생성, 파일명은 `.txt` 확장자 포함
   - **목표:** 텍스트 파일을 디렉토리에 저장

4. **디렉토리 읽기 기능**

   - **입력:** 디렉토리명
   - **기능:** 해당 디렉토리 내의 파일 및 디렉토리 목록을 읽어 출력
   - **목표:** 파일 이름과 용량 포함한 정보 출력

5. **텍스트 파일 읽기 기능**

   - **입력:** 디렉토리명, 텍스트 파일명
   - **기능:** 지정된 텍스트 파일의 내용을 읽어 출력
   - **목표:** 해당 파일의 내용 확인

6. **영속성 보장 (종료 및 재시작 지원)**
   - **기능:** 프로그램 종료 후 재시작 시에도 디렉토리와 파일 상태가 유지되도록 저장
   - **목표:** 파일 시스템의 영속성을 보장, 종료 후 다시 실행 시 이전 상태 유지

---

## 사용한 모듈

### Node의 fs(filesystem module)
